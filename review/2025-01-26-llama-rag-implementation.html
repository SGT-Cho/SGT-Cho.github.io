<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Llamaì— RAGë¥¼ ì ìš©í•˜ì—¬ ë˜‘ë˜‘í•œ ì¸ê³µì§€ëŠ¥ ë§Œë“¤ê¸° | Minjae's Life & Review Blog</title>

  <meta name="description" content="LLaMA ëª¨ë¸ì— RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì„ ì ìš©í•˜ëŠ” ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ ë° ì£¼ì˜ì‚¬í•­">
  <meta name="keywords" content="LLaMA, RAG, LangChain, AI, ì¸ê³µì§€ëŠ¥, LLM, ê²€ìƒ‰ ê¸°ë°˜ ìƒì„±, ë²¡í„°DB, FAISS, Ollama">
  <meta name="author" content="Minjae Cho">

  <meta property="og:title" content="Llamaì— RAGë¥¼ ì ìš©í•˜ì—¬ ë˜‘ë˜‘í•œ ì¸ê³µì§€ëŠ¥ ë§Œë“¤ê¸° | Minjae's Life & Review Blog">
  <meta property="og:description" content="LLaMA ëª¨ë¸ì— RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì„ ì ìš©í•˜ëŠ” ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ ë° ì£¼ì˜ì‚¬í•­">
  <meta property="og:url" content="https://sgt-cho.github.io/review/2025-01-26-llama-rag-implementation.html"> <meta property="og:type" content="article">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Llamaì— RAGë¥¼ ì ìš©í•˜ì—¬ ë˜‘ë˜‘í•œ ì¸ê³µì§€ëŠ¥ ë§Œë“¤ê¸°">
  <meta name="twitter:description" content="LLaMA ëª¨ë¸ì— RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì„ ì ìš©í•˜ëŠ” ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ ë° ì£¼ì˜ì‚¬í•­">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/style.css"> <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true});</script>


  <link rel="icon" type="image/x-icon" href="/assets/images/minjae.png"> <link rel="manifest" href="/manifest.json"> </head>
<body>
  <header>
    <nav>
      <a href="/" class="nav-logo"> <img src="/assets/images/minjae.png" alt="Minjae Cho"> <span>Minjae Cho</span>
      </a>

      <div class="nav-links">
        <a href="/life/">Life</a> <a href="/review/" class="active">Review</a> <a href="/portfolio/">Portfolio</a> <a href="/archive/">Archive</a> <a href="/about/">About</a> </div>

      <div class="hamburger" aria-label="ë©”ë‰´ ì—´ê¸°" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>
  </header>

  <article class="post">
    <div class="container">
      <h1>Llamaì— RAGë¥¼ ì ìš©í•˜ì—¬ ë˜‘ë˜‘í•œ ì¸ê³µì§€ëŠ¥ ë§Œë“¤ê¸°</h1>

      <div class="meta">
        <div>
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          January 26, 2025
        </div>

        <div>
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          6 min read </div>

        <div>
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          <a href="/review/">Review</a> </div>
      </div>

      <div class="post-tags">
        <a href="/tags/LLaMA/" class="post-tag">LLaMA</a> <a href="/tags/RAG/" class="post-tag">RAG</a> <a href="/tags/LangChain/" class="post-tag">LangChain</a> <a href="/tags/AI/" class="post-tag">AI</a> <a href="/tags/LLM/" class="post-tag">LLM</a> <a href="/tags/ë²¡í„°DB/" class="post-tag">ë²¡í„°DB</a> <a href="/tags/Ollama/" class="post-tag">Ollama</a> <a href="/tags/êµ¬í˜„ê°€ì´ë“œ/" class="post-tag">êµ¬í˜„ê°€ì´ë“œ</a> </div>

      <div class="post-content">
        <h2>1. ê¸°ë³¸ ì¤€ë¹„ ì‚¬í•­</h2>
        <ul>
          <li><strong>Ollama ì„¤ì¹˜</strong>: <a href="https://ollama.ai/" target="_blank" rel="noopener noreferrer">ê³µì‹ ë¬¸ì„œ</a> ì°¸ì¡°</li>
          <li><strong>LLaMA3 ëª¨ë¸ ë¡œë“œ</strong>:
            <pre><code>ollama pull llama3</code></pre>
          </li>
          <li><strong>í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬</strong>:
            <pre><code>pip install langchain langchain_community faiss-cpu sentence-transformers</code></pre>
            (Note: `faiss-cpu` assumes CPU usage. For GPU, use `faiss-gpu`.)<br>
            (Note: Added `langchain_community` based on recent LangChain updates)
          </li>
        </ul>

        <hr/>

        <h2>2. RAG ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h2>
        <pre class="mermaid">
flowchart LR
    A[ì‚¬ìš©ì ì§ˆë¬¸] --> B[ì§ˆë¬¸ ì„ë² ë”©]
    B --> C[ë²¡í„°DB ìœ ì‚¬ë„ ê²€ìƒ‰]
    C --> D[ê´€ë ¨ ë¬¸ì„œ ì²­í¬ ì¶”ì¶œ]
    D --> E[LLaMA3 ë‹µë³€ ìƒì„±]
        </pre>

        <hr/>

        <h2>3. ë‹¨ê³„ë³„ êµ¬í˜„ (ì €ì‘ê¶Œ ì£¼ì˜ì‚¬í•­ í¬í•¨)</h2>

        <h3>1. ë°ì´í„° ì¤€ë¹„</h3>
        <ul>
          <li><strong>âœ… í—ˆìš© ë°ì´í„°</strong>:
            <ul>
              <li>ìì²´ ì œì‘ ë¬¸ì„œ</li>
              <li>CC-BY, MIT License ë“± <strong>ì˜¤í”ˆ ë¼ì´ì„ ìŠ¤</strong> ìë£Œ</li>
              <li>ìœ„í‚¤ë°±ê³¼(CC BY-SA 3.0)</li>
            </ul>
          </li>
          <li><strong>âŒ ê¸ˆì§€ ë°ì´í„°</strong>:
            <ul>
              <li>ì €ì‘ê¶Œì´ ìˆëŠ” ì„œì /ë…¼ë¬¸</li>
              <li>ì›¹ ìŠ¤í¬ë˜í•‘ ë°ì´í„°(ëª…ì‹œì  í—ˆë½ ì—†ì„ ì‹œ)</li>
            </ul>
          </li>
        </ul>

        <h3>2. ë¬¸ì„œ ì²­í‚¹ & ì„ë² ë”©</h3>
        <pre><code>from langchain.text_splitter import RecursiveCharacterTextSplitter
# from langchain.embeddings import HuggingFaceEmbeddings # Deprecated
from langchain_community.embeddings import HuggingFaceEmbeddings # Correct import
from langchain_community.document_loaders import TextLoader # Example loader

# ì˜ˆì‹œ: ë¡œì»¬ í…ìŠ¤íŠ¸ íŒŒì¼ ë¡œë“œ (ë°˜ë“œì‹œ ìì‹ ì˜ ë°ì´í„°ë¡œ ëŒ€ì²´)
# loader = TextLoader("your_document.txt", encoding="utf-8")
# your_own_data = loader.load() # Load your data here

# ì‹¤ì œ ì‚¬ìš© ì‹œ your_own_data ë³€ìˆ˜ì— ë¡œë“œëœ Document ê°ì²´ ë¦¬ìŠ¤íŠ¸ë¥¼ í• ë‹¹í•˜ì„¸ìš”.
# ì˜ˆì‹œë¥¼ ìœ„í•´ ì„ì‹œ ë°ì´í„° ìƒì„± (ì‹¤ì œë¡œëŠ” íŒŒì¼ ë¡œë“œ í•„ìš”)
from langchain_core.documents import Document
your_own_data = [Document(page_content="ì—¬ê¸°ì— ìì²´ ì œì‘ ë¬¸ì„œ ë˜ëŠ” í—ˆìš©ëœ ë°ì´í„°ë¥¼ ë„£ìœ¼ì„¸ìš”. ì €ì‘ê¶Œì— ìœ ì˜í•˜ì„¸ìš”.")]

# ë¬¸ì„œ ë¶„í• 
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=512,  # ì²­í¬ í¬ê¸° ì¡°ì •
    chunk_overlap=50
)
chunks = text_splitter.split_documents(your_own_data)  # ë°˜ë“œì‹œ ìì²´ ë°ì´í„° ì‚¬ìš©

# ì„ë² ë”© ìƒì„±
embedder = HuggingFaceEmbeddings(model_name="sentence-transformers/all-mpnet-base-v2")
# í•œêµ­ì–´ ëª¨ë¸ ì˜ˆì‹œ: embedder = HuggingFaceEmbeddings(model_name="jhgan/ko-sroberta-multitask")
</code></pre>

        <h3>3. ë²¡í„° DB êµ¬ì¶•</h3>
        <pre><code># from langchain.vectorstores import FAISS # Deprecated
from langchain_community.vectorstores import FAISS # Correct import

# FAISS ë²¡í„° ì €ì¥ì†Œ ìƒì„±
vector_db = FAISS.from_documents(
    documents=chunks,
    embedding=embedder
)
vector_db.save_local("your_custom_index")  # ê³ ìœ í•œ ì¸ë±ìŠ¤ ì´ë¦„ ì‚¬ìš©
</code></pre>

        <h3>4. ê²€ìƒ‰ & ìƒì„± íŒŒì´í”„ë¼ì¸</h3>
        <pre><code>from langchain.chains import RetrievalQA
# from langchain.llms import Ollama # Deprecated
from langchain_community.llms import Ollama # Correct import
# from langchain.prompts import PromptTemplate # Deprecated
from langchain_core.prompts import PromptTemplate # Correct import

# ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ì˜ (Llama3 í˜•ì‹ ì¤€ìˆ˜)
template = """&lt;|begin_of_text|&gt;&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;

You are an assistant for question-answering tasks. Use the following pieces of retrieved context to answer the question. If you don't know the answer, just say that you don't know. Use three sentences maximum and keep the answer concise. Do not mention the source of the context in your answer.&lt;|eot_id|&gt;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;

Question: {question}
Context: {context}

&lt;|eot_id|&gt;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;
Answer:"""
custom_prompt = PromptTemplate(template=template, input_variables=["context", "question"])


# RAG ì²´ì¸ êµ¬ì„±
llm = Ollama(model="llama3") # ë¡œì»¬ Ollamaì—ì„œ llama3 ëª¨ë¸ ì‚¬ìš©
retriever = vector_db.as_retriever(search_kwargs={"k": 3}) # ìƒìœ„ 3ê°œ ì²­í¬ ê²€ìƒ‰

rag_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type="stuff", # "stuff" ë°©ì‹ ì‚¬ìš© (ê°€ì¥ ì¼ë°˜ì )
    retriever=retriever,
    chain_type_kwargs={"prompt": custom_prompt},
    return_source_documents=True # ì†ŒìŠ¤ ë¬¸ì„œ ë°˜í™˜ ì—¬ë¶€
)
</code></pre>
        <p><em>ì°¸ê³ : ìœ„ LangChain ì½”ë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì— ë”°ë¼ ì„í¬íŠ¸ ê²½ë¡œ ë° í´ë˜ìŠ¤ ì´ë¦„ì´ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì‹  LangChain ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”. Llama3 ëª¨ë¸ì˜ í”„ë¡¬í”„íŠ¸ í˜•ì‹ì„ ë”°ë¥´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</em></p>
        <hr/>

        <h2>4. ì‹¤í–‰ ì˜ˆì‹œ (ìì²´ ë°ì´í„° ê¸°ë°˜)</h2>
        <pre><code># ì‚¬ìš©ì ì •ì˜ ì§ˆì˜ì‘ë‹µ
question = "ìš°ë¦¬ íšŒì‚¬ ì œí’ˆì˜ ì£¼ìš” ê¸°ìˆ ì€ ë¬´ì—‡ì¸ê°€ìš”?"  # ì‹¤ì œ ìì‚¬ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
# response = rag_chain.run(question) # .run is deprecated
response = rag_chain.invoke({"query": question}) # invoke ì‚¬ìš©

print("ë‹µë³€:", response['result'])
# print("\nì°¸ê³  ë¬¸ì„œ:")
# for doc in response['source_documents']:
#     print("- ", doc.page_content[:100] + "...") # ë‚´ìš© ì¼ë¶€ ì¶œë ¥
</code></pre>

        <hr/>

        <h2>5. ì£¼ì˜ì‚¬í•­</h2>
        <ol>
          <li><strong>ë°ì´í„° ì†Œì‹±</strong>: ë°˜ë“œì‹œ ì‚¬ìš© ê¶Œí•œì´ í™•ì¸ëœ ë°ì´í„°ë§Œ í™œìš© (ì €ì‘ê¶Œ ì¹¨í•´ ê¸ˆì§€)</li>
          <li><strong>ì¶œë ¥ ê²€ì¦</strong>: ìƒì„± ê²°ê³¼ê°€ íŠ¹ì • ì €ì‘ë¬¼ì„ ê·¸ëŒ€ë¡œ ë³µì œí•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸ í•„ìš”</li>
          <li><strong>ì„ë² ë”© ëª¨ë¸</strong>: ë¬¸ì„œ ë° ì§ˆë¬¸ì˜ ì–¸ì–´ì— ë§ëŠ” ëª¨ë¸ ì„ íƒ (ì˜ˆ: í•œêµ­ì–´ `jhgan/ko-sroberta-multitask`, ë‹¤êµ­ì–´ `intfloat/multilingual-e5-large`)</li>
          <li><strong>ëª¨ë¸ íŠœë‹</strong>: LoRA ë“± íŒŒë¼ë¯¸í„° íš¨ìœ¨ì  íŒŒì¸íŠœë‹(PEFT) ê¸°ë²•ì„ í™œìš©í•´ ìì²´ ë°ì´í„°ë¡œ ë¯¸ì„¸ì¡°ì • ì‹œ RAG ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥</li>
        </ol>
        <blockquote>
          ğŸ’¡ <strong>ì°¸ê³ </strong>: RAG ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì€ ê²€ìƒ‰ì— ì‚¬ìš©ë˜ëŠ” **ë°ì´í„°ì˜ í’ˆì§ˆ**ê³¼ **ì„ë² ë”© ëª¨ë¸ì˜ ì„±ëŠ¥**ì— í¬ê²Œ ì˜ì¡´í•©ë‹ˆë‹¤. ìì²´ ì§€ì‹ ë² ì´ìŠ¤ë¥¼ ì²´ê³„ì ìœ¼ë¡œ êµ¬ì¶•í•˜ê³  ì ì ˆí•œ ì„ë² ë”© ëª¨ë¸ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.
        </blockquote>
      </div>
    </div>
  </article>

  <footer>
    <div class="container">
      <p>&copy; 2025 Minjae Cho Â· Built with passion and code</p> </div>
  </footer>

  <script src="/js/main.js"></script> </body>
</html>